{"version":3,"sources":["../../src/lib/replacements.ts"],"sourcesContent":["import type { DbType, StorageAdapterType } from '../types.js'\n\ntype DbAdapterReplacement = {\n  configReplacement: (envName?: string) => string[]\n  importReplacement: string\n  packageName: string\n}\n\nconst mongodbReplacement: DbAdapterReplacement = {\n  // Replacement between `// database-adapter-config-start` and `// database-adapter-config-end`\n  configReplacement: (envName = 'DATABASE_URI') => [\n    '  db: mongooseAdapter({',\n    `    url: process.env.${envName} || '',`,\n    '  }),',\n  ],\n  importReplacement: \"import { mongooseAdapter } from '@payloadcms/db-mongodb'\",\n  packageName: '@payloadcms/db-mongodb',\n}\n\nconst postgresReplacement: DbAdapterReplacement = {\n  configReplacement: (envName = 'DATABASE_URI') => [\n    '  db: postgresAdapter({',\n    '    pool: {',\n    `      connectionString: process.env.${envName} || '',`,\n    '    },',\n    '  }),',\n  ],\n  importReplacement: \"import { postgresAdapter } from '@payloadcms/db-postgres'\",\n  packageName: '@payloadcms/db-postgres',\n}\n\nconst vercelPostgresReplacement: DbAdapterReplacement = {\n  configReplacement: (envName = 'POSTGRES_URL') => [\n    '  db: vercelPostgresAdapter({',\n    '    pool: {',\n    `      connectionString: process.env.${envName} || '',`,\n    '    },',\n    '  }),',\n  ],\n  importReplacement: \"import { vercelPostgresAdapter } from '@payloadcms/db-vercel-postgres'\",\n  packageName: '@payloadcms/db-vercel-postgres',\n}\n\nconst sqliteReplacement: DbAdapterReplacement = {\n  configReplacement: (envName = 'DATABASE_URI') => [\n    '  db: sqliteAdapter({',\n    '    client: {',\n    `      url: process.env.${envName} || '',`,\n    '    },',\n    '  }),',\n  ],\n  importReplacement: \"import { sqliteAdapter } from '@payloadcms/db-sqlite'\",\n  packageName: '@payloadcms/db-sqlite',\n}\n\nconst d1SqliteReplacement: DbAdapterReplacement = {\n  configReplacement: (envName = 'DATABASE_URI') => [\n    'db: sqliteD1Adapter({ binding: cloudflare.env.D1 }),',\n  ],\n  importReplacement: \"import { sqliteD1Adapter } from '@payloadcms/db-d1-sqlite'\",\n  packageName: '@payloadcms/db-d1-sqlite',\n}\n\nexport const dbReplacements: Record<DbType, DbAdapterReplacement> = {\n  'd1-sqlite': d1SqliteReplacement,\n  mongodb: mongodbReplacement,\n  postgres: postgresReplacement,\n  sqlite: sqliteReplacement,\n  'vercel-postgres': vercelPostgresReplacement,\n}\n\ntype StorageAdapterReplacement = {\n  configReplacement: string[]\n  importReplacement?: string\n  packageName?: string\n}\n\nconst vercelBlobStorageReplacement: StorageAdapterReplacement = {\n  // Replacement of `// storage-adapter-placeholder`\n  configReplacement: [\n    '    vercelBlobStorage({',\n    '      collections: {',\n    '        media: true,',\n    '      },',\n    \"      token: process.env.BLOB_READ_WRITE_TOKEN || '',\",\n    '    }),',\n  ],\n  importReplacement: \"import { vercelBlobStorage } from '@payloadcms/storage-vercel-blob'\",\n  packageName: '@payloadcms/storage-vercel-blob',\n}\n\nconst r2StorageReplacement: StorageAdapterReplacement = {\n  // Replacement of `// storage-adapter-placeholder`\n  configReplacement: [\n    '    r2Storage({',\n    '      bucket: cloudflare.env.R2,',\n    '      collections: { media: true },',\n    '    }),',\n  ],\n  importReplacement: \"import { r2Storage } from '@payloadcms/storage-r2'\",\n  packageName: '@payloadcms/storage-r2',\n}\n\n// Removes placeholders\nconst diskReplacement: StorageAdapterReplacement = {\n  configReplacement: [],\n  importReplacement: '',\n}\n\nexport const storageReplacements: Record<StorageAdapterType, StorageAdapterReplacement> = {\n  localDisk: diskReplacement,\n  r2Storage: r2StorageReplacement,\n  vercelBlobStorage: vercelBlobStorageReplacement,\n}\n\n/**\n * Generic config replacement\n */\ntype ConfigReplacement = {\n  configReplacement: {\n    match: string\n    replacement: string\n  }\n  importReplacement: string\n  packageName: string\n}\n\nexport const configReplacements: Record<string, ConfigReplacement> = {\n  sharp: {\n    // Replacement of `sharp, // Now optional`\n    configReplacement: {\n      match: 'sharp,',\n      replacement: '  // sharp,',\n    },\n    importReplacement: \"import sharp from 'sharp'\",\n    packageName: 'sharp',\n  },\n}\n"],"names":["mongodbReplacement","configReplacement","envName","importReplacement","packageName","postgresReplacement","vercelPostgresReplacement","sqliteReplacement","d1SqliteReplacement","dbReplacements","mongodb","postgres","sqlite","vercelBlobStorageReplacement","r2StorageReplacement","diskReplacement","storageReplacements","localDisk","r2Storage","vercelBlobStorage","configReplacements","sharp","match","replacement"],"mappings":"AAQA,MAAMA,qBAA2C;IAC/C,8FAA8F;IAC9FC,mBAAmB,CAACC,UAAU,cAAc,GAAK;YAC/C;YACA,CAAC,qBAAqB,EAAEA,QAAQ,OAAO,CAAC;YACxC;SACD;IACDC,mBAAmB;IACnBC,aAAa;AACf;AAEA,MAAMC,sBAA4C;IAChDJ,mBAAmB,CAACC,UAAU,cAAc,GAAK;YAC/C;YACA;YACA,CAAC,oCAAoC,EAAEA,QAAQ,OAAO,CAAC;YACvD;YACA;SACD;IACDC,mBAAmB;IACnBC,aAAa;AACf;AAEA,MAAME,4BAAkD;IACtDL,mBAAmB,CAACC,UAAU,cAAc,GAAK;YAC/C;YACA;YACA,CAAC,oCAAoC,EAAEA,QAAQ,OAAO,CAAC;YACvD;YACA;SACD;IACDC,mBAAmB;IACnBC,aAAa;AACf;AAEA,MAAMG,oBAA0C;IAC9CN,mBAAmB,CAACC,UAAU,cAAc,GAAK;YAC/C;YACA;YACA,CAAC,uBAAuB,EAAEA,QAAQ,OAAO,CAAC;YAC1C;YACA;SACD;IACDC,mBAAmB;IACnBC,aAAa;AACf;AAEA,MAAMI,sBAA4C;IAChDP,mBAAmB,CAACC,UAAU,cAAc,GAAK;YAC/C;SACD;IACDC,mBAAmB;IACnBC,aAAa;AACf;AAEA,OAAO,MAAMK,iBAAuD;IAClE,aAAaD;IACbE,SAASV;IACTW,UAAUN;IACVO,QAAQL;IACR,mBAAmBD;AACrB,EAAC;AAQD,MAAMO,+BAA0D;IAC9D,kDAAkD;IAClDZ,mBAAmB;QACjB;QACA;QACA;QACA;QACA;QACA;KACD;IACDE,mBAAmB;IACnBC,aAAa;AACf;AAEA,MAAMU,uBAAkD;IACtD,kDAAkD;IAClDb,mBAAmB;QACjB;QACA;QACA;QACA;KACD;IACDE,mBAAmB;IACnBC,aAAa;AACf;AAEA,uBAAuB;AACvB,MAAMW,kBAA6C;IACjDd,mBAAmB,EAAE;IACrBE,mBAAmB;AACrB;AAEA,OAAO,MAAMa,sBAA6E;IACxFC,WAAWF;IACXG,WAAWJ;IACXK,mBAAmBN;AACrB,EAAC;AAcD,OAAO,MAAMO,qBAAwD;IACnEC,OAAO;QACL,0CAA0C;QAC1CpB,mBAAmB;YACjBqB,OAAO;YACPC,aAAa;QACf;QACApB,mBAAmB;QACnBC,aAAa;IACf;AACF,EAAC"}